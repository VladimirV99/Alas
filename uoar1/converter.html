<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8"/>
  <title>Konverter</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <script type="text/javascript" src="uoar_core.js"></script>
  <script type="text/javascript" src="type_converter.js"></script>
  <script type="text/javascript" src="output.js"></script>
  <script>

    function convertBase(){
      var val = document.getElementById('input').value;
      var base1 = document.getElementById('base_src').value;
      var base2 = document.getElementById('base_dest').value;
      if(val=="" || base1=="" || base2=="")
        return;

      clearStackTrace();
      clearOutput();
      var res = convertBases(toUOARNumber(val, base1, NumberTypes.SIGNED, true), base2, false, true);

      document.getElementById("text1").innerHTML=output;
    }

    function toDecimal(number, standardized=false, log=true){
      if(!standardized){
        number = standardizeUOARNumber(number.copy(), log);
        if(number === null){
          addToStackTrace("toDecimal", "Invalid number \"" + number + "\" for base " + base, log);
          return null;
        }
      }
      if(number.base==10){
        return number;
      }
      var work1 = "";
      var work2 = "";
      addToOutput("(" + number.toSigned() + ")" + number.base + " = ");

      var whole = 0;
      var num_length = number.whole.length-1;
      var temp;
      for(let i = 0; i<number.whole.length; i++){
        temp = getValueAt(number.whole, i, log);
        work1 = work1.concat(temp + "*" + number.base + "^" + num_length);
        work2 = work2.concat(temp * Math.pow(number.base, num_length));
        whole = whole * number.base + temp;

        num_length--;
        if(num_length>=0){
          work1 = work1.concat(" + ");
          work2 = work2.concat(" + ");
        }
      }
      whole = whole.toString();

      var fraction = 0;
      var precision = PRECISION_NUMBER / number.base;
      var base_deg = number.base;
      for(let i = 0; i<number.fraction.length; i++){
        temp = getValueAt(number.fraction, i, log);
        work1 = work1.concat(" + " + temp + "*" + number.base + "^(-" + (i+1) + ")");
        work2 = work2.concat(" + " + temp + "/" + base_deg);
        fraction += Math.floor(temp * precision);
        precision = precision / number.base;
        base_deg = base_deg * number.base;
      }
      fraction = fraction.toString();
      
      var res = new UOARNumber(number.sign, whole, fraction, 10, number.number_type);
      res = trimNumber(res);
      addToOutput(work1 + " = ");
      addToOutput(work2 + " = ");
      addToOutput("(" + res.toSigned() + ")10");
      return res;
    }

    function fromDecimal(number, base, standardized=false, log=true){
      if(!standardized){
        number = standardizeUOARNumber(number.copy(), log);
        if(number === null){
          addToStackTrace("fromDecimal", "Invalid number \"" + number + "\" for base 10", log);
          return null;
        }
      }
      if(base==10){
        return number;
      }
      
      var work1 = "";
      var work2 = "";

      var whole = "";
      var whole_dec = baseToDecimalInteger(number.whole, number.base, NumberTypes.UNSIGNED, log);
      if(whole_dec==0){
        whole = "0";
      }else{
        work1 = "<td>" + whole_dec + "</td>";
        work2 = "";
        do {
          work1 = work1.concat("<td>" + Math.floor(whole_dec/base) + "</td>");
          work2 = work2.concat("<td>" + (whole_dec%base) + "</td>");
          whole = toValue(whole_dec%base, false).concat(whole);
          whole_dec = Math.floor(whole_dec/base);
        } while(whole_dec>0)
        work2 = work2.concat("<td></td>");
        addToOutput("<table>");
        addToOutput("<tr>");
        addToOutput(work1);
        addToOutput("</tr>");
        addToOutput("<tr>");
        addToOutput(work2);
        addToOutput("</tr>");
        addToOutput("</table>");
      }
      
      var fraction = "";
      if(number.fraction!=""){
        number = fractionToLength(number, PRECISION, log);
        let fraction_dec = baseToDecimalInteger(number.fraction, number.base, NumberTypes.UNSIGNED, log);
        let limit = 0;
        let temp = 0;
        work1 = "<td>" + trimNumber(new UOARNumber(number.sign, "0", fraction_dec.toString(), number.base, number.number_type)).toUnsigned() + "</td>";
        work2 = "<td>" + temp + "</td>";
        while(fraction_dec>0 && limit<PRECISION){
          fraction_dec = fraction_dec*base;
          temp = Math.floor(fraction_dec/PRECISION_NUMBER);
          fraction_dec -= temp*PRECISION_NUMBER;
          work1 = work1.concat("<td>" + trimNumber(new UOARNumber(number.sign, "0", fraction_dec.toString(), number.base, number.number_type)).toUnsigned() + "</td>");
          work2 = work2.concat("<td>" + toValue(temp, false) + "</td>");
          fraction = fraction.concat(toValue(temp, false));
          limit++;
        }
        addToOutput("<table>");
        addToOutput("<tr>");
        addToOutput(work1);
        addToOutput("</tr>");
        addToOutput("<tr>");
        addToOutput(work2);
        addToOutput("</tr>");
        addToOutput("</table>");
      }

      var res = new UOARNumber(number.sign, whole, fraction, base, number.number_type);
      addToOutput(res.toSigned());
      return res;
    }

    function convertType(){
      var val = document.getElementById('input').value;
      var base = document.getElementById('base_src').value;
      if(val=="" || base=="")
        return;

      clearStackTrace();
      clearOutput();
      var number = toUOARNumber(val, base, NumberTypes.SIGNED, true);
      
      addToOutput("(" + number.toSigned() + ")" + number.base + "<br>");
      addToOutput("ZAV: (" + convertToSMR(number, false, true).toSigned() + ")" + number.base + "<br>");
      addToOutput("NK: (" + convertToOC(number, true, true).toSigned() + ")" + number.base + "<br>");
      addToOutput("PK: (" + convertToTC(number, true, true).toSigned() + ")" + number.base + "<br>");

      document.getElementById("text1").innerHTML=output;
    }
  </script>
</head>
<body>

  <div class="container" id="main">

    <p>Pretvoriti broj: </p>
    <input type="text" id="input"></input>
    <p>Iz sistema: </p>
    <input type="number" id="base_src"></input>
    <p>U sistem: </p>
    <input type="number" id="base_dest"></input>
    <br><br>
    <input value="Pretvori u osnovu" type="button" name="convertBase" id="convertBase" onclick="convertBase()"></input>
    <input value="Pretvori u zapise" type="button" name="convertType" id="convertType" onclick="convertType()"></input>

    <p id="text1">
      resenje
    </p>

  </div>

</body>
</html>
