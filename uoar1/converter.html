<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8"/>
  <title>Konverter</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <script type="text/javascript" src="uoar_core.js"></script>
  <script type="text/javascript" src="output.js"></script>
  <script>

    function calculate(){
      var val = document.getElementById('input').value;
      var base1 = document.getElementById('base_src').value;
      var base2 = document.getElementById('base_dest').value;

      clearStackTrace();
      clearOutput();
      var res = convertBases(toUOARNumber(val, base1, NumberTypes.SIGNED, true), base2, false, true);

      document.getElementById("text1").innerHTML=output;
    }

    function toDecimal(number, standardized=false, log=true){
      if(!standardized){
        number = standardizeUOARNumber(number, log);
        if(number == null){
          addToStackTrace("toDecimal", "Invalid number \"" + number + "\" for base " + base, log);
          return null;
        }
      }
      if(number.base==10){
        return number;
      }
      var work1 = "";
      var work2 = "";
      addToOutput("(" + number.toSigned() + ")" + number.base + " = ");

      var temp;
      var num_length = number.whole.length-1;
      var whole = 0;
      let i = 0;
      while(num_length>=0){
        temp = getValueAt(number.whole, i, log);
        work1 = work1.concat(temp + "*" + number.base + "^" + (num_length));
        temp = temp * Math.pow(number.base, num_length);
        work2 = work2.concat(temp);
        whole += temp;
        i++;
        num_length--;
        if(num_length>0){
          work1 = work1.concat("+");
          work2 = work2.concat("+");
        }
      }
      whole = whole.toString();

      var fraction = 0;
      var frac_len = number.fraction.length;
      for(let i = 0; i<frac_len; i++){
        temp = getValueAt(number.fraction, i, log);
        work1 = work1.concat(" + " + temp + "*" + number.base + "^(-" + (i+1) + ")");
        work2 = work2.concat(" + " + temp + "/" + Math.pow(number.base, i+1));
  
        fraction += (Math.floor(temp * PRECISION_NUMBER / Math.pow(number.base, i+1)));
      }
      fraction = fraction.toString();
      
      var res = new UOARNumber(number.sign, whole, fraction, 10, number.number_type);
      res = trimNumber(res);
      addToOutput(work1 + " = ");
      addToOutput(work2 + " = ");
      addToOutput("(" + res.toSigned() + ")10");
      return res;
    }

    function fromDecimal(number, base, standardized=false, log=true){
      if(!standardized){
        number = standardizeUOARNumber(number, log);
        if(number == null){
          addToStackTrace("fromDecimal", "Invalid number \"" + number + "\" for base 10", log);
          return null;
        }
      }
      if(base==10){
        return number;
      }
      
      var whole = UOARNumberToDecimalInteger(number);
      var fraction = "";

      var work1 = "<td>" + whole + "</td>";
      var work2 = "";

      var num_arr = [];
      if(whole<0)
        whole = -whole;
      while(whole>0){
        work1 = work1.concat("<td>" + Math.floor(whole/base) + "</td>");
        work2 = work2.concat("<td>" + (whole%base) + "</td>");
        num_arr.push(toValue(whole%base));
        whole = Math.floor(whole/base);
      }
      work2 = work2.concat("<td></td>");
      num_arr.reverse();
      whole = num_arr.join("");
      addToOutput("<table>");
      addToOutput("<tr>");
      addToOutput(work1);
      addToOutput("</tr>");
      addToOutput("<tr>");
      addToOutput(work2);
      addToOutput("</tr>");
      addToOutput("</table>");
      
      if(number.fraction!=""){
        number = fractionToLength(number, PRECISION, log);
        var frac = UOARNumberToDecimalInteger(new UOARNumber(number.sign, number.fraction, "", number.base, number.number_type), false, true);
        var limit = 0;
        var temp = 0;
        work1 = "<td>" + trimNumber(new UOARNumber(number.sign, "0", frac.toString(), number.base, number.number_type)).toUnsigned() + "</td>";
        work2 = "<td>" + temp + "</td>";
        while(frac>0 && limit<PRECISION){
          frac = frac*base;
          temp = Math.floor(frac/PRECISION_NUMBER);
          frac -= temp*PRECISION_NUMBER;
          work1 = work1.concat("<td>" + trimNumber(new UOARNumber(number.sign, "0", frac.toString(), number.base, number.number_type)).toUnsigned() + "</td>");
          work2 = work2.concat("<td>" + toValue(temp) + "</td>");
          fraction = fraction.concat(temp);
          limit++;
        }
      }
      addToOutput("<table>");
      addToOutput("<tr>");
      addToOutput(work1);
      addToOutput("</tr>");
      addToOutput("<tr>");
      addToOutput(work2);
      addToOutput("</tr>");
      addToOutput("</table>");

      var res = new UOARNumber(number.sign, whole, fraction, base, number.number_type);
      addToOutput(res.toSigned());
      return res;
    }

    function test(){
      runTests();
    }
  </script>
</head>
<body>

  <div class="container" id="main">

    <p>Pretvoriti broj: </p>
    <input type="text" id="input"></input>
    <p>Iz sistema: </p>
    <input type="number" id="base_src"></input>
    <p>U sistem: </p>
    <input type="number" id="base_dest"></input>
    <br><br>
    <input value="Izracunaj" type="button" name="calc" id="calc" onclick="calculate()"></input>

    <p id="text1">
      resenje
    </p>

    <input value="Test" type="button" name="test" id="test" onclick="test()"></input>


  </div>

</body>
</html>
