<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8"/>
  <title>Konverter</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <script type="text/javascript" src="uoar_core.js"></script>
  <script>

    function calculate(){
      var significand = document.getElementById('significand').value;
      var exponent = document.getElementById('exponent').value;
      // var base2 = document.getElementById('base_dest').value;

      var res = convert(significand, exponent);

      document.getElementById("text1").innerHTML=res;
    }

    function calculate2(){
      var significand = document.getElementById('significand').value;
      var exponent = document.getElementById('exponent').value;
      var res = convert2(significand, exponent);
      document.getElementById("text1").innerHTML=res;
    }

    function calculate3(){
      var significand = document.getElementById('significand').value;
      var exponent = document.getElementById('exponent').value;
      var res = convert3(significand, exponent);
      document.getElementById("text1").innerHTML=res;
    }

    function convert(significand, exponent){
      // var val_dec = toDecimal(val, base1);
      //
      // console.log(val_dec);
      //
      // return fromDecimal(val_dec, base2)


      significand = trimSign(significand);
      exponent = parseInt(exponent) + getNormailzeExponentBinary(significand);
      significand = normalizeBinary(significand);

      console.log(significand + " * 2 ^ " + exponent);
      //significand = significand, 23);

       res = "";
       if(significand[0]=='-')
        res+="1";
      else
        res+="0";

        res+=" ";
        //console.log((101+exponent).toString());
        //console.log(fromDecimal(trimSign((101+exponent).toString()), 2));
        res+= addZeroesBefore(fromDecimal(trimSign((127+exponent).toString()), 2), 8).substr(1);


res+=" ";
        res+=addZeroesAfter(significand.split(/[.,]/)[1], 23);
console.log(res);



      // var ret = [];
      // while(val_dec>0){
      //   ret.push(toValue(val_dec%base2));
      //   val_dec = Math.floor(val_dec/base2);
      // }
      // ret.reverse();
      // console.log(ret);
      //
      // res = "";
      // for(i = 0; i<ret.length; i++){
      //   console.log(i + " " + ret[i]);
      //   res = res.concat(ret[i]);
      // }
      // console.log(res);
       return res;
    }

    function convert2(significand, exponent){
      significand = trimSign(significand);
      exponent = parseInt(exponent) + getNormailzeExponentBinary(significand);
      significand = normalizeBinary(significand);

      console.log(significand + " * 2 ^ " + exponent);

      res = "";
      if(significand[0]=='-')
       res+="1";
     else
       res+="0";

       res+=" ";
       //console.log((101+exponent).toString());
       //console.log(fromDecimal(trimSign((101+exponent).toString()), 2));
       res+= addZeroesBefore(fromDecimal(trimSign((1023+exponent).toString()), 2), 11).substr(1);


res+=" ";
       res+=addZeroesAfter(significand.split(/[.,]/)[1], 52);
console.log(res);
    }

    function convert3(significand, exponent){
      significand = trimSign(significand);
      exponent = parseInt(exponent) + getNormailzeExponentDecimal(significand);
      significand = addZeroesBefore(normalizeDecimal(significand), 7);

      console.log(significand + " * 10 ^ " + exponent);

      res = "";
      if(significand[0]=='-')
       res+="1";
     else
       res+="0";

       res+=" ";
       //console.log((101+exponent).toString());
       //console.log(fromDecimal(trimSign((101+exponent).toString()), 2));

    na = digitToBinary(significand[1]);
       nb= addZeroesBefore(fromDecimal(trimSign((101+exponent).toString()), 2), 8).substr(1);
console.log(na + " " + nb);
       if(na[0]=='0'){
         res+=nb.substr(0,2)+na.substr(1,3)+nb.substr(2,6);
       }

       console.log(res);



res+=" ";
       //res+=addZeroesAfter(significand.split(/[.,]/)[1], 52);
       //console.log(res);
       console.log("t2 " + decimalTo8421(significand.substr(2, 3)) + " " + significand.substr(2, 3));
       nc1 = decimalToDPD(decimalTo8421(significand.substr(2, 3)));
       console.log(nc1);
       nc2 = decimalToDPD(decimalTo8421(significand.substr(5, 3)));
       console.log(nc2);

       nc =  nc1+ nc2;
       res += nc;
console.log(res);
return res;
    }

    

    function normalizeBinary(number){
      number = trimSign(number);
      res = number[0]+"0";
      console.log(number);
      for(i=1; i<number.length; i++){
        if(number[i]!='0'  && number[i]!='.' && number[i]!=','){
          console.log(i + " " + number[i]);
          res += number[i];
          if(number.length>i){
            res += "." + number.substr(i+1).replace(/[.,]/, "")

          }
          console.log(res);
          break;
        }
      }
      res = trimNumber(res);
      return res;
    }

    function normalizeDecimal(number){
      number = trimSign(number);
      number = trimNumber(number);
      return number.split(/[.,]/).join("");
      // res = number[0]+"0";
      // console.log(number);
      // for(i=1; i<number.length; i++){
      //   if(number[i]!='0'  && number[i]!='.' && number[i]!=','){
      //     console.log(i + " " + number[i]);
      //     res += number[i];
      //     if(number.length>i){
      //       res += "." + number.substr(i+1).replace(/[.,]/, "")
      //
      //     }
      //     console.log(res);
      //     break;
      //   }
      // }
      // res = trimNumber(res);
      // return res;
    }

    function getNormailzeExponentBinary(number){
      number = trimSign(number);
      var i, j;
      for(i=1; i<number.length; i++){
        if(number[i]=='.'){
          break;
        }
      }

      //var j;
      //TODO MErge In One Loop
      for(j=1; j<number.length; j++){
        if(number[j]!='0'){
          break;
        }
      }

      return i-j-1;

    }

    function getNormailzeExponentDecimal(number){
      number = trimSign(number);
      number = trimNumber(number);


      var res = 0;
      arr = number.split(/[.,]/);
      if(arr.length==2){
        res = -arr[1].length;
        console.log("qq " + res + " " + number);
      }else if(arr.length==1){
        console.log("qq2 " +  number);
        for(n=number.length-1; n>=0; n--){
          console.log(n + " " + number[n]);
          if(number[n]!='0'){
            break;
          }
        }
        console.log(n + " " + arr[0].length);
        res = n-arr[0].length+1;
      }
      return res;

      // var i, j;
      // for(i=1; i<number.length; i++){
      //   if(number[i]=='.'){
      //     break;
      //   }
      // }
      //
      // //var j;
      // //TODO MErge In One Loop
      // for(j=1; j<number.length; j++){
      //   if(number[j]!='0'){
      //     break;
      //   }
      // }
      //
      // return i-j-1;

    }



    function decimalToDPD(number){
      if(number.length>12){
        return null; //TODO If >12 do recursion
      }
      else if(number.length<12){
        number = addZeroesBefore(number, 12);
      }
// console.log(number);
// console.log(number.substr(0,4));
// console.log(number.substr(4,4));
// console.log(number.substr(8,4));
      arr = [number.substr(0,4), number.substr(4,4), number.substr(8, 4)];
      console.log(arr.join("-"));

      num_l = 0;
      if(arr[0][0]=='1')
        num_l++;
        if(arr[1][0]=='1')
          num_l++;
          if(arr[2][0]=='1')
            num_l++;

      aei = number[0] + number[4] + number[8];
      // if(aei == "000"){
      //
      // }
      var res = "";
      if(num_l==0){
        //res = number.substr(1,3) + number.substr(5,3) + "0" + number.substr(9,3);
        res = arr[0].substr(1) + arr[1].substr(1) + "0" + arr[2].substr(1);
      }else if(num_l==1){
        if(aei[0] == '1'){
          res += arr[2].substr(1,2) + arr[0][3];
        }else{
          res += arr[0].substr(1,3);
        }
         if(aei[1]=='1'){
          res += arr[2].substr(1,2) + arr[1][3];
        }else{
          res += arr[1].substr(1,3);
        }
        res += "1" + aei.substr(0,2) + arr[2][3];

      }else if(num_l==2){
          if(aei=="110")
            res += arr[2].substr(1,2) + arr[0][3] + "00";
          else if(aei=="101")
            res += arr[1].substr(1, 2) + arr[0][3] + "01";
          else {
            res += arr[0].substr(1,3) + "10";
          }
          res += arr[1][3] + "111" + arr[2][3];
      }else {
          res += "00"+arr[0][3] + "11" + arr[1][3] + "11" + arr[2][3];
      }

      return res;

    }

    function DPDtoDecimal(number){
      if(number.length!=10)
      return null; //do recursion if number%10==0

      vwxst = number[6] + number[7] + number[8] + number[3] + number[4];

var res =  "";
      if(vwxst[0]=="0"){
        res += "0" + number.substr(0, 3) + "0" + number.substr(3, 3) + "0" + number.substr(7,3);
      }else {
        temp = vwxst.substr(1,2);
        if(temp=="00"){
          res += "0" + number.substr(0, 3) + "0" + number.substr(3, 3) + "100" + number[9];
        }else if(temp=="01"){
          res += "0" + number.substr(0, 3) + "100" + number[5] + "0" + number.substr(3,2) + number[9];
        }else if(temp=="10"){
          res += "100" + number[2] + "0" + number.substr(3, 3) + "0" + number.substr(0, 2) + number[9];
        }else{
          temp = vwxst.substr(3,2);
          if(temp=="00"){
            res += "100" + number[2] + "100" + number[5] + "0" + number.substr(0, 2) + number[9];
          }else if(temp=="01"){
            res += "100" + number[2] + "0" + number.substr(0, 2) + number[5] + "100" + number[9];
          }else if(temp=="10"){
            res += "0" + number.substr(0, 3) + "100" + number[5] + "100" + number[9];
          }else{
            res += "100"+number[2]+"100"+number[5]+"100"+number[8];
          }
        }
      }
      return res;
    }


    function divide(dividend, divisor, base){

    }

    function addSigned(add1, add2, base){

    }

    function test(){
      //console.log("GV-" + getValueAt("1DEE", 4));
      //console.log("TN-"+trimSign("--+-+--123"));
      //console.log("TD-"+toDecimal("123", 10));
      //console.log("C-"+convert("7DE2", 16, 8));
      //console.log("FD2- " + fromDecimal("-83.625", 8));
      //console.log("TrimNumber - " + trimNumber("+--000.25"));
      //console.log("TrimNumber - " + trimNumber("-01.10101000001100"));
      //console.log("TrimNumber - " + trimNumber("-00.010101000001100"));
      //console.log("getNormailzeExponent - " + getNormailzeExponentBinary("-0.1010000011"));
      //console.log("normailze - " + normalizeBinary("-10101000.0011"));
      //console.log("Add Zeroes Before - " + addZeroesBefore("+0.12", 5));
      //console.log("Add Zeroes After - " + addZeroesAfter("+0.12", 5));
      // console.log("bcd1 - " + digitToBinary("6"));
      //console.log("bcd1 - " + digitToBinary("7"));
       // console.log("bcd2 - " + decimalTo8421("678"));
      // console.log("toDPD - " + decimalToDPD("100101101000")); // 111 010 1 110
      // console.log("fromDPD - " + DPDtoDecimal("1110101110"));
      //console.log("normailzeDec - " + normalizeDecimal("-10101000.00110"));
      console.log("normailzeDec - " + getNormailzeExponentDecimal("-246.8957"));
      //console.log("getNormailzeExponent - " + getNormailzeExponentDecimal("-10101000.00"));
    }
  </script>
</head>
<body>

  <div class="container" id="main">

    <!-- <p>Pretvoriti broj: </p> -->
    <input type="number" id="significand"></input>
    <p>*10^</p>
    <input type="number" id="exponent"></input>
    <!-- <p>U sistem: </p>
    <input type="number" id="base_dest"></input> -->
    <br><br>
    <input value="Izracunaj binary32" type="button" name="calc" id="calc" onclick="calculate()"></input>
    <input value="Izracunaj binary64" type="button" name="calc2" id="calc2" onclick="calculate2()"></input>
    <input value="Izracunaj decimal32" type="button" name="calc3" id="calc3" onclick="calculate3()"></input>



    <p id="text1">
      resenje
    </p>

    <input value="Test" type="button" name="test" id="test" onclick="test()"></input>


  </div>

</body>
</html>
