<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8"/>
  <title>Butov Algoritam</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <script type="text/javascript" src="uoar_core.js"></script>
  <script type="text/javascript" src="output.js"></script>
  <script>

    function calculate() {

      var multiplicand = fromDecimal(toUOARNumber(document.getElementById('multiplicand').value, 10, NumberTypes.SIGNED, false), 2, false, true);
      var multiplier = fromDecimal(toUOARNumber(document.getElementById('multiplier').value, 10, NumberTypes.SIGNED, false), 2, false, true);
      clearOutput();
      clearStackTrace();
      var res = booth(multiplicand, multiplier, true, true);
      if(res!=null){
        document.getElementById("text1").innerHTML = output;
      }
    }

    function booth(num1, num2, standardized=false, log=true){
      if(num1.base!=2 || num2.base!=2){ //TODO Convert to Binary
        addToStackTrace("booth", "Operands are not binary", log);
        return;
      }
      //TODO Check for operand fractions and return

      //TODO How fromDecimal treats negative numbers
      n1 = convertToType(trimSign(num1), NumberTypes.TC, standardized, log);
      n2 = convertToType(trimSign(num2), NumberTypes.TC, standardized, log);
      equalizeLength(n1, n2, true, log);
      console.log(n1);
      console.log(n2);
      var len = n1.toSigned().length;

      var a = wholeToLength(new UOARNumber("0", "0", "", 2, NumberTypes.TC), len-1, log);
      var m = n1;
      var neg_m = complement(n1);
      var p = n2;
      var p1 = new UOARNumber("0", "", "", 2, NumberTypes.TC);
      var registers = [a, p, p1];

      addToOutput("<table>");
      addToOutput("<tr><th>A</th><th>P</th><th>P0</th><th>Poruka</th></tr>");
      addToOutput("<tr><td>" + registers[0].toSigned() + "</td><td>" + registers[1].toSigned() + "</td><td>" + registers[2].toSigned() + "</td><td>Init</td></tr>");
      var work1 = "";
      var work2 = "";
      for(let im=0; im<len; im++){
        addToOutput("<tr>");
        
        op = registers[1].toSigned().charAt(registers[1].toSigned().length-1) + registers[2].toSigned();
        work1 = "";
        work2 = op + " -> ";
        if(op=="00" || op=="11"){
          work2 = work2.concat("NOOP");
        }else if(op=="10"){
          registers[0] = add(registers[0], neg_m, NumberTypes.TC, true, log);
          work1 = "+" + neg_m.toSigned() + "<br>" + registers[0].toSigned() + "<br>";
          work2 = work2.concat("A = A - M");
        }else if(op=="01"){
          registers[0] = add(registers[0], m, NumberTypes.TC, true, log);
          work1 = "+" + m.toSigned() + "<br>" + registers[0].toSigned() + "<br>";
          work2 = work2.concat("A = A + M"); 
        }
        
        shift(registers, 1, ShiftTypes.RIGHT_A);
        work1 = work1.concat(registers[0].toSigned());

        addToOutput("<td>" + work1 + "</td>");
        addToOutput("<td>" + registers[1].toSigned() + "</td>");
        addToOutput("<td>" + registers[2].toSigned() + "</td>");
        addToOutput("<td>" + work2 + "</td>");
        addToOutput("</tr>");
      }
      addToOutput("</table>");
      addToOutput("AP = (" + registers[0].toSigned() + " " + registers[1].toSigned() + ")2");
      return registers[0].toSigned() + registers[1].toSigned();
    }

    function test(){
      //console.log(removeSign("+--1-+123", 10, NumberTypes.SIGNED, true));

      // console.log(baseToDecimalInteger("---123", 10, NumberTypes.SIGNED, true));
      // var number = toUOARNumber("99123.110", 10, NumberTypes.TC, true);
      // console.log(UOARNumberToDecimalInteger(number, false, true));

      //var number = toUOARNumber("110010.110", 2, NumberTypes.TC, true);
      //shift([number], 3, ShiftTypes.LEFT);
      //console.log(number);

      // var number = new UOARNumber("111", "110101", "0100", 2, NumberTypes.TC);
      // trimSign(number);
      // trimNumber(number);
      // console.log(number);

      // console.log("complement - " + complement(toUOARNumber("00", 2, NumberTypes.TC, true), false, true).toSigned());
      // console.log("add - " + add(toUOARNumber("-17", 10, NumberTypes.SIGNED, true), toUOARNumber("+15", 10, NumberTypes.SIGNED, true), NumberTypes.SIGNED, false, true).toSigned());
      
      // var n1 = fromDecimal(toUOARNumber("-91", 10, NumberTypes.SIGNED, false), 2, false, true);
      // var n2 = fromDecimal(toUOARNumber("22", 10, NumberTypes.SIGNED, false), 2, false, true);
      // console.log("booth - " + booth(n1, n2, false, true)); //TODO Error on empty fields
    }

  </script>
</head>
<body>
  <input type="number" id="multiplicand"></input>
  <input type="number" id="multiplier"></input>
  <input type="button" name="calc" id="calc" value="Calculate" onclick="calculate()"></input>

  <p id="text1">
    text
  </p>

  <input type="button" name="test" id="test" value="Test" onclick="test()"></input>


</body>
</html>
