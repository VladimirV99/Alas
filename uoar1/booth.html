<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8"/>
  <title>Butov Algoritam</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <script type="text/javascript" src="uoar_core.js"></script>
  <script type="text/javascript" src="output.js"></script>
  <script>

    function convertToTC(number, standardized=false, log=true){
      if(!standardized){ //TODO Dont stadardize only trim sign for signed on a copy
        number = standardizeUOARNumber(number, log);
        if(number==null){
          addToStackTrace("complement", "Number is invalid", log);
          return null;
        }
      }
      
      switch(number.number_type){
        case NumberTypes.SIGNED:
          number.number_type = NumberTypes.TC;
          if(number.sign == "-"){
            number.sign = "0";
            return complement(number);
          }else{
            number.sign = "0";
            return number;
          }
          break;
        case NumberTypes.OC:
          number = addToLowestPoint(number, 1, log);
          return number;
        case NumberTypes.TC:
          return number;
      }
    }

    function convertToType(number, type, standardized=false, log=true){
      if(number.number_type==type)
        return number;
      switch(type){
        case NumberTypes.TC:
          return convertToTC(number);
      }
      return null;
    }

    function calculate() {

      var multiplicand = fromDecimal(toUOARNumber(document.getElementById('multiplicand').value, 10, NumberTypes.SIGNED, false), 2, false, true);
      var multiplier = fromDecimal(toUOARNumber(document.getElementById('multiplier').value, 10, NumberTypes.SIGNED, false), 2, false, true);
      clearOutput();
      clearStackTrace();
      var res = booth(multiplicand, multiplier);
      if(res!=null){
        document.getElementById("text1").innerHTML = output;
      }
      

      // document.getElementById("text1").innerHTML=
      // signedToTC(fromDecimal(document.getElementById('multiplicand').value, 2), 2)
      // +" * "+
      // signedToTC(fromDecimal(document.getElementById('multiplier').value, 2), 2);
    }

    // function convertToBinary(x){
    //   console.log(x);

    //   var sign = "0";
    //   var ret = "";
    //   var num_length = 0;

    //   if(x<0){
    //     sign="1";
    //     x = -x;
    //   }

    //   var deg = 1;
    //   while(deg<=x){
    //     deg = deg*2;
    //   }
    //   deg = deg/2;

    //   while(deg>=1){

    //     if(x>=deg){
    //       ret = ret.concat("1");
    //       x = x - deg;
    //     } else {
    //       ret = ret.concat("0");
    //     }

    //     num_length++;
    //     deg = deg/2;
    //   }
    //     console.log("2 " + num_length + " " + ret);

    //   var sign_c = 0;
    //   var sign_counter = 8-((num_length+1)%8);
    //   var new_sign = sign;
    //   while(sign_c<sign_counter){
    //     new_sign = new_sign.concat(sign);
    //     sign_c++;
    //   }
    //     console.log("3 " + sign + " " + sign_counter);

    //   ret = new_sign.concat(ret);
    //   return ret;
    // }

    // function toBinary(number){
    //   number = trimSign(number);
    // }



    function shiftLeft(number, times, prev){
      //TODO Implement for UOARNumber
      s_num = "";
      if(number.length>times){
        s_num = number.substr(times);
      }


      s_prev = prev;
      if(prev.length-times>0){
        s_prev = prev.substr(0, times);
      }


      console.log(s_prev + " " + s_num + " " + prev + " " + prev.length);
      if(s_prev.length+s_num.length<number.length){
      //  console.log(s_prev.length+s_num.length);
        //console.log(number.length);
        s_prev = addZeroesAfter(s_prev, number.length-s_num.length);
      }
      var res = s_num +s_prev;
      return res;

    }


    function booth(num1, num2, standardized=false, log=true){
      n1 = convertToType(trimSign(num1), NumberTypes.TC, standardized, log);
      n2 = convertToType(trimSign(num2), NumberTypes.TC, standardized, log);


      //TODO How fromDecimal treats negative numbers


      equalizeLength(n1, n2, true, log);
      console.log(n1);
      console.log(n2);
      var len = n1.toSigned().length;


      var a = wholeToLength(new UOARNumber("0", "0", "", 2, NumberTypes.TC), len-1, log);
      console.log(a);
      var m = n1;
      var neg_m = complement(n1);
      console.log(neg_m);
      var p = n2;
      var p1 = new UOARNumber("0", "", "", 2, NumberTypes.TC);
      var registers = [a, p, p1];

      for(let im=0; im<len; im++){
        op = p.toSigned().charAt(p.toSigned().length-1) + p1.toSigned();
        console.log(a.toSigned() + " " + p.toSigned() + " " + p1.toSigned()+ " - " + op);
        if(op=="10"){
          a = add(a, neg_m, NumberTypes.TC, true, log);
        }else if(op=="01"){
          a = add(a, m, NumberTypes.TC, true, log);
        }
        shiftRightA([a, p, p1], 1, log);
      }
      console.log(a.toSigned()+p.toSigned());
      return a.toSigned() + p.toSigned();


    }

    function test(){
      
      
      var number = toUOARNumber("110010.11", 2, NumberTypes.TC, true);
      shiftRightA([number], 3);
      //console.log("complement - " + complement(toUOARNumber("00", 2, NumberTypes.TC, true), false, true).toSigned());

      //console.log("add - " + add(toUOARNumber("110.1", 2, NumberTypes.TC, true), toUOARNumber("11011.11", 2, NumberTypes.TC, true), NumberTypes.TC, false, true).toSigned());
      
      //console.log("fromDecimal - " + fromDecimal(toUOARNumber("964.5", 10, NumberTypes.TC, true), 2, false, true).toSigned());
      console.log("shiftRightA - " + number.toSigned());
      
      
      // console.log("shiftRightA - " + shiftRightA("11011101", 2,2, "")); //TODO Remove spaces when reading numbers
      //console.log("booth - " + booth("-91", "22") );
      // console.log("shiftRightA - " + shiftRightL("11011101", 2,2, "")); //TODO Remove spaces when reading numbers
      // console.log("shiftLeft - " + shiftLeft("11011101", 3, "01")); //TODO Remove spaces when reading numbers

    }

  </script>
</head>
<body>
  <input type="number" id="multiplicand"></input>
  <input type="number" id="multiplier"></input>
  <input type="button" name="calc" id="calc" onclick="calculate()">Calculate</input>

  <p id="text1">
    text
  </p>

  <input value="Test" type="button" name="test" id="test" onclick="test()"></input>


</body>
</html>
